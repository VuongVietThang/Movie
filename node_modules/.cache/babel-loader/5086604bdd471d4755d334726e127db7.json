{"ast":null,"code":"var _jsxFileName = \"C:\\\\wamp64\\\\www\\\\Movie\\\\src\\\\Components\\\\Admin\\\\movieForm.jsx\",\n    _s = $RefreshSig$();\n\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport 'primereact/resources/themes/lara-light-indigo/theme.css';\nimport 'primereact/resources/primereact.min.css';\nimport 'primeicons/primeicons.css';\nimport \"./admin.css\";\nimport { CFormInput, CFormTextarea } from \"@coreui/react\";\nimport { MultiSelect } from \"primereact/multiselect\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction MovieForm() {\n  _s();\n\n  const [title, setTitle] = useState(\"\");\n  const [author, setAuthor] = useState(\"\");\n  const [genres, setGenres] = useState([]); // Danh sách thể loại từ backend\n\n  const [selectedGenres, setSelectedGenres] = useState([]); // Danh sách object thể loại\n\n  const [description, setDescription] = useState(\"\");\n  const [releaseDate, setReleaseDate] = useState(\"\");\n  const [video, setVideo] = useState(null);\n  const [poster, setPoster] = useState(null);\n  const [movieGenresId, setMovieGenresId] = useState([]); // Mảng id để xử lý edit\n\n  const style = {\n    section: {\n      padding: \"10px 0px\"\n    }\n  };\n  const {\n    id\n  } = useParams();\n  const navigate = useNavigate();\n  const API_BASE = \"http://localhost/Movie/backend/API\";\n  useEffect(() => {\n    const link = document.createElement(\"link\");\n    link.rel = \"stylesheet\";\n    link.href = \"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\";\n    link.integrity = \"sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7OgzF1O2yZl3hZl+Yj9STmGhH3fY65wAa3r\";\n    link.crossOrigin = \"anonymous\";\n    document.head.appendChild(link);\n    return () => {\n      document.head.removeChild(link);\n    };\n  }, []); // Lấy danh sách thể loại\n\n  useEffect(() => {\n    axios.get(`${API_BASE}/genres.php`).then(res => setGenres(res.data)).catch(err => console.error(\"Lỗi khi lấy danh sách thể loại:\", err));\n  }, []); // Lấy thông tin phim nếu có id (edit)\n\n  useEffect(() => {\n    if (id) {\n      axios.get(`${API_BASE}/get_movie.php?id=${id}`).then(res => {\n        const movie = res.data;\n        setTitle(movie.title);\n        setAuthor(movie.author);\n        setDescription(movie.description);\n        setReleaseDate(movie.release_date);\n        setPoster(movie.poster_url);\n        setMovieGenresId(movie.genres_id); // Mảng ID\n      }).catch(err => console.error(\"Lỗi khi lấy thông tin phim:\", err));\n    }\n  }, [id]); // Ghép genres_id và genres để tạo selectedGenres (ép kiểu id để tránh sai .includes)\n\n  useEffect(() => {\n    if (genres.length > 0 && movieGenresId.length > 0) {\n      const matchedGenres = genres.filter(genre => movieGenresId.includes(Number(genre.id)));\n      setSelectedGenres(matchedGenres);\n    }\n  }, [genres, movieGenresId]);\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    const formData = new FormData();\n    formData.append(\"title\", title);\n    formData.append(\"author\", author);\n    formData.append(\"description\", description);\n    formData.append(\"release_date\", releaseDate);\n    selectedGenres.forEach(genre => {\n      formData.append(\"category[]\", genre.id);\n    });\n    if (video) formData.append(\"video\", video);\n    if (poster) formData.append(\"poster\", poster);\n    const request = id ? axios.post(`${API_BASE}/update_movie.php?id=${id}`, formData, {\n      headers: {\n        \"Content-Type\": \"multipart/form-data\"\n      }\n    }) : axios.post(`${API_BASE}/add_movie.php`, formData, {\n      headers: {\n        \"Content-Type\": \"multipart/form-data\"\n      }\n    });\n    request.then(() => navigate(\"/admin\")).catch(err => console.error(\"Lỗi khi gửi dữ liệu:\", err));\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: handleSubmit,\n    className: \"space-y-4 p-5\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: style.section,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"block font-medium\",\n        children: \"Movie Title\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CFormInput, {\n        value: title,\n        onChange: e => setTitle(e.target.value),\n        type: \"text\",\n        placeholder: \"Movie Title\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: style.section,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"block font-medium\",\n        children: \"Author\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CFormInput, {\n        value: author,\n        onChange: e => setAuthor(e.target.value),\n        type: \"text\",\n        placeholder: \"Author\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: style.section,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"block font-medium\",\n        children: \"Genres\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(MultiSelect, {\n        value: selectedGenres,\n        onChange: e => setSelectedGenres(e.value),\n        options: genres,\n        optionLabel: \"name\",\n        display: \"chip\",\n        placeholder: \"Select Genres\",\n        maxSelectedLabels: 3,\n        className: \"w-full\",\n        style: {\n          width: \"100%\",\n          height: \"40px\",\n          display: \"flex\",\n          alignItems: \"center\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: style.section,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"block font-medium\",\n        children: \"Description\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CFormTextarea, {\n        className: \"mb-3\",\n        value: description,\n        onChange: e => setDescription(e.target.value),\n        placeholder: \"Description\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: style.section,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"block font-medium\",\n        children: \"Ng\\xE0y xu\\u1EA5t b\\u1EA3n\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"date\",\n        value: releaseDate,\n        onChange: e => setReleaseDate(e.target.value),\n        className: \"border w-full px-2 py-1\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: style.section,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"block font-medium\",\n        children: \"T\\u1EA3i \\u1EA3nh poster\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        onChange: e => setPoster(e.target.files[0]),\n        className: \"border w-full px-2 py-1\",\n        required: !id\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: style.section,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"block font-medium\",\n        children: \"T\\u1EA3i video l\\xEAn\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        onChange: e => setVideo(e.target.files[0]),\n        className: \"border w-full px-2 py-1\",\n        required: !id\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"bg-green-500 text-white px-4 py-2 button rounded\",\n      type: \"submit\",\n      children: id ? \"Cập nhật\" : \"Thêm\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 113,\n    columnNumber: 5\n  }, this);\n}\n\n_s(MovieForm, \"dGy2/IA267iaVML7hDDwGiVFYKA=\", false, function () {\n  return [useParams, useNavigate];\n});\n\n_c = MovieForm;\nexport default MovieForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"MovieForm\");","map":{"version":3,"sources":["C:/wamp64/www/Movie/src/Components/Admin/movieForm.jsx"],"names":["useNavigate","useParams","useState","useEffect","axios","CFormInput","CFormTextarea","MultiSelect","MovieForm","title","setTitle","author","setAuthor","genres","setGenres","selectedGenres","setSelectedGenres","description","setDescription","releaseDate","setReleaseDate","video","setVideo","poster","setPoster","movieGenresId","setMovieGenresId","style","section","padding","id","navigate","API_BASE","link","document","createElement","rel","href","integrity","crossOrigin","head","appendChild","removeChild","get","then","res","data","catch","err","console","error","movie","release_date","poster_url","genres_id","length","matchedGenres","filter","genre","includes","Number","handleSubmit","e","preventDefault","formData","FormData","append","forEach","request","post","headers","target","value","width","height","display","alignItems","files"],"mappings":"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","sourcesContent":["import { useNavigate, useParams } from \"react-router-dom\";\r\nimport { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nimport 'primereact/resources/themes/lara-light-indigo/theme.css';\r\nimport 'primereact/resources/primereact.min.css';\r\nimport 'primeicons/primeicons.css';\r\n\r\nimport \"./admin.css\";\r\nimport { CFormInput, CFormTextarea } from \"@coreui/react\";\r\nimport { MultiSelect } from \"primereact/multiselect\";\r\n\r\nfunction MovieForm() {\r\n  const [title, setTitle] = useState(\"\");\r\n  const [author, setAuthor] = useState(\"\");\r\n  const [genres, setGenres] = useState([]); // Danh sách thể loại từ backend\r\n  const [selectedGenres, setSelectedGenres] = useState([]); // Danh sách object thể loại\r\n  const [description, setDescription] = useState(\"\");\r\n  const [releaseDate, setReleaseDate] = useState(\"\");\r\n  const [video, setVideo] = useState(null);\r\n  const [poster, setPoster] = useState(null);\r\n  const [movieGenresId, setMovieGenresId] = useState([]); // Mảng id để xử lý edit\r\n\r\n  const style = {\r\n    section: {\r\n      padding: \"10px 0px\"\r\n    }\r\n  };\r\n\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const API_BASE = \"http://localhost/Movie/backend/API\";\r\n\r\n  useEffect(() => {\r\n  const link = document.createElement(\"link\");\r\n  link.rel = \"stylesheet\";\r\n  link.href = \"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\";\r\n  link.integrity = \"sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7OgzF1O2yZl3hZl+Yj9STmGhH3fY65wAa3r\";\r\n  link.crossOrigin = \"anonymous\";\r\n  document.head.appendChild(link);\r\n\r\n  return () => {\r\n    document.head.removeChild(link);\r\n  };\r\n}, []);\r\n\r\n  // Lấy danh sách thể loại\r\n  useEffect(() => {\r\n    axios\r\n      .get(`${API_BASE}/genres.php`)\r\n      .then((res) => setGenres(res.data))\r\n      .catch((err) => console.error(\"Lỗi khi lấy danh sách thể loại:\", err));\r\n  }, []);\r\n\r\n  // Lấy thông tin phim nếu có id (edit)\r\n  useEffect(() => {\r\n    if (id) {\r\n      axios\r\n        .get(`${API_BASE}/get_movie.php?id=${id}`)\r\n        .then((res) => {\r\n          const movie = res.data;\r\n          setTitle(movie.title);\r\n          setAuthor(movie.author);\r\n          setDescription(movie.description);\r\n          setReleaseDate(movie.release_date);\r\n          setPoster(movie.poster_url);\r\n          setMovieGenresId(movie.genres_id); // Mảng ID\r\n        })\r\n        .catch((err) => console.error(\"Lỗi khi lấy thông tin phim:\", err));\r\n    }\r\n  }, [id]);\r\n\r\n  // Ghép genres_id và genres để tạo selectedGenres (ép kiểu id để tránh sai .includes)\r\n  useEffect(() => {\r\n    if (genres.length > 0 && movieGenresId.length > 0) {\r\n      const matchedGenres = genres.filter((genre) =>\r\n        movieGenresId.includes(Number(genre.id))\r\n      );\r\n      setSelectedGenres(matchedGenres);\r\n    }\r\n  }, [genres, movieGenresId]);\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n\r\n    const formData = new FormData();\r\n    formData.append(\"title\", title);\r\n    formData.append(\"author\", author);\r\n    formData.append(\"description\", description);\r\n    formData.append(\"release_date\", releaseDate);\r\n\r\n    selectedGenres.forEach((genre) => {\r\n      formData.append(\"category[]\", genre.id);\r\n    });\r\n\r\n    if (video) formData.append(\"video\", video);\r\n    if (poster) formData.append(\"poster\", poster);\r\n\r\n    const request = id\r\n      ? axios.post(`${API_BASE}/update_movie.php?id=${id}`, formData, {\r\n          headers: { \"Content-Type\": \"multipart/form-data\" },\r\n        })\r\n      : axios.post(`${API_BASE}/add_movie.php`, formData, {\r\n          headers: { \"Content-Type\": \"multipart/form-data\" },\r\n        });\r\n\r\n    request\r\n      .then(() => navigate(\"/admin\"))\r\n      .catch((err) => console.error(\"Lỗi khi gửi dữ liệu:\", err));\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-4 p-5\">\r\n      <div style={style.section}>\r\n        <label className=\"block font-medium\">Movie Title</label>\r\n        <CFormInput\r\n          value={title}\r\n          onChange={(e) => setTitle(e.target.value)}\r\n          type=\"text\"\r\n          placeholder=\"Movie Title\"\r\n          required\r\n        />\r\n      </div>\r\n\r\n      <div style={style.section}>\r\n        <label className=\"block font-medium\">Author</label>\r\n        <CFormInput\r\n          value={author}\r\n          onChange={(e) => setAuthor(e.target.value)}\r\n          type=\"text\"\r\n          placeholder=\"Author\"\r\n          required\r\n        />\r\n      </div>\r\n\r\n      <div style={style.section}>\r\n        <label className=\"block font-medium\">Genres</label>\r\n        <MultiSelect\r\n          value={selectedGenres}\r\n          onChange={(e) => setSelectedGenres(e.value)}\r\n          options={genres}\r\n          optionLabel=\"name\"\r\n          display=\"chip\"\r\n          placeholder=\"Select Genres\"\r\n          maxSelectedLabels={3}\r\n          className=\"w-full\"\r\n          style={{\r\n            width: \"100%\",\r\n            height: \"40px\",\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      <div style={style.section}>\r\n        <label className=\"block font-medium\">Description</label>\r\n        <CFormTextarea\r\n          className=\"mb-3\"\r\n          value={description}\r\n          onChange={(e) => setDescription(e.target.value)}\r\n          placeholder=\"Description\"\r\n          required\r\n        />\r\n      </div>\r\n\r\n      <div style={style.section}>\r\n        <label className=\"block font-medium\">Ngày xuất bản</label>\r\n        <input\r\n          type=\"date\"\r\n          value={releaseDate}\r\n          onChange={(e) => setReleaseDate(e.target.value)}\r\n          className=\"border w-full px-2 py-1\"\r\n          required\r\n        />\r\n      </div>\r\n\r\n      <div style={style.section}>\r\n        <label className=\"block font-medium\">Tải ảnh poster</label>\r\n        <input\r\n          type=\"file\"\r\n          onChange={(e) => setPoster(e.target.files[0])}\r\n          className=\"border w-full px-2 py-1\"\r\n          required={!id}\r\n        />\r\n      </div>\r\n\r\n      <div style={style.section}>\r\n        <label className=\"block font-medium\">Tải video lên</label>\r\n        <input\r\n          type=\"file\"\r\n          onChange={(e) => setVideo(e.target.files[0])}\r\n          className=\"border w-full px-2 py-1\"\r\n          required={!id}\r\n        />\r\n      </div>\r\n\r\n      <button\r\n        className=\"bg-green-500 text-white px-4 py-2 button rounded\"\r\n        type=\"submit\"\r\n      >\r\n        {id ? \"Cập nhật\" : \"Thêm\"}\r\n      </button>\r\n    </form>\r\n  );\r\n}\r\n\r\nexport default MovieForm;\r\n"]},"metadata":{},"sourceType":"module"}